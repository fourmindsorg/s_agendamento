{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Sistema de Agendamentos{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="{% static 'favicon.ico' %}" type="image/x-icon">
      
    <!-- Font Awesome (Local) -->
    <link rel="stylesheet" href="{% static 'css/fontawesome/all.min.css' %}">
    
    <!-- Google Fonts (Local) -->
    <link rel="stylesheet" href="{% static 'fonts/inter.css' %}">
    
    <!-- CSS -->
    {% comment %} boostrap {% endcomment %}
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}" />
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    
    {% comment %} plot {% endcomment %}
    <script src="{% static 'js/vendor/plotly.min.js' %}"></script>
    
    {% block extra_css %}{% endblock %}
    
<style>
        :root {
            --primary-color: {{ paleta_cores.primary }};
            --secondary-color: {{ paleta_cores.secondary }};
            --success-color: {{ paleta_cores.success }};
            --warning-color: {{ paleta_cores.warning }};
            --danger-color: {{ paleta_cores.danger }};
            --info-color: {{ paleta_cores.info }};
            --light-color: {{ paleta_cores.light }};
            --dark-color: {{ paleta_cores.dark }};
            --background-color: {{ paleta_cores.background }};
            --surface-color: {{ paleta_cores.surface }};
            --text-color: {{ paleta_cores.text }};
            --text-muted-color: {{ paleta_cores.text_muted }};
            --border-color: {{ paleta_cores.border }};
            --gradient-bg: {{ paleta_cores.gradient }};
            --shadow-color: {{ paleta_cores.shadow }};
            
            /* Layout Variables */
            --sidebar-width: 280px;
            --sidebar-collapsed-width: 70px;
            --topbar-height: 70px;
            --transition-speed: 0.3s;
        }
        
        /* CORREÇÃO: Forçar cores de texto em modo escuro */
        {% if is_dark_mode %}
            body, body * {
                color: var(--text-color) !important;
            }
            
            /* Exceções para elementos que devem manter cor específica */
            .text-primary { color: var(--primary-color) !important; }
            .text-secondary { color: var(--secondary-color) !important; }
            .text-success { color: var(--success-color) !important; }
            .text-warning { color: var(--warning-color) !important; }
            .text-danger { color: var(--danger-color) !important; }
            .text-info { color: var(--info-color) !important; }
            .text-light { color: var(--light-color) !important; }
            .text-dark { color: var(--dark-color) !important; }
            .text-muted { color: var(--text-muted-color) !important; }
            .text-white { color: #ffffff !important; }
            
            /* Botões com cores específicas */
            .btn-primary, .btn-primary *, 
            .btn-success, .btn-success *,
            .btn-warning, .btn-warning *,
            .btn-danger, .btn-danger *,
            .btn-info, .btn-info *,
            .btn-light, .btn-light *,
            .btn-dark, .btn-dark * {
             color: white !important;
            }
            
            /* Badges */
            .badge, .badge * {
                color: white !important;
            }
            
            /* Headers de cards com background colorido */
            .card-header.bg-primary, .card-header.bg-primary *,
            .card-header.bg-success, .card-header.bg-success *,
            .card-header.bg-warning, .card-header.bg-warning *,
            .card-header.bg-danger, .card-header.bg-danger *,
            .card-header.bg-info, .card-header.bg-info *,
            .card-header.bg-dark, .card-header.bg-dark * {
                color: white !important;
            }
        {% endif %}
        
        /* CORREÇÃO: Ocultar texto do logo quando sidebar colapsado */
        .sidebar.collapsed .logo-text {
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
        }
        
        #sidebar.collapsed .sidebar-logo .logo-text {
            display: none !important;
        }
        
        /* CORREÇÃO: Garantir que ícones dos botões herdem a cor do texto */
        .btn-custom i,
        .btn-outline-custom i,
        .btn-custom .fas,
        .btn-outline-custom .fas {
            color: inherit !important;
        }
        
        .btn-custom:hover i,
        .btn-outline-custom:hover i,
        .btn-custom:hover .fas,
        .btn-outline-custom:hover .fas {
            color: inherit !important;
        }
</style>

</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <!-- Logo -->
        <div class="sidebar-logo">
            <div class="logo-icon m-0">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <a href="{% url 'agendamentos:dashboard' %}" class="logo-text">
                Agenda Fácil
            </a>
        </div>
        
        <!-- Menu -->
        <div class="sidebar-menu">
            <div class="menu-item">
                <a href="{% url 'agendamentos:dashboard' %}" class="menu-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                    <i class="menu-icon fas fa-tachometer-alt"></i>
                    <span class="menu-text">Dashboard</span>
                </a>
            </div>
            
            <div class="menu-item">
                <a href="{% url 'agendamentos:agendamento_list' %}" class="menu-link {% if 'agendamento' in request.resolver_match.url_name and 'dashboard' not in request.resolver_match.url_name %}active{% endif %}">
                    <i class="menu-icon fas fa-calendar-check"></i>
                    <span class="menu-text">Agendamentos</span>
                    {% if agendamentos_pendentes > 0 %}
                    <span class="menu-badge">{{ agendamentos_pendentes }}</span>
                    {% endif %}
                </a>
            </div>
            
            <div class="menu-item">
                <a href="{% url 'agendamentos:cliente_list' %}" class="menu-link {% if 'cliente' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="menu-icon fas fa-users"></i>
                    <span class="menu-text">Clientes</span>
                </a>
            </div>
            
            <div class="menu-item">
                <a href="{% url 'agendamentos:servico_list' %}" class="menu-link {% if 'servico' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="menu-icon fas fa-cogs"></i>
                    <span class="menu-text">Serviços</span>
                </a>
            </div>
            
            <div class="menu-item">
                <a href="{% url 'agendamentos:relatorios' %}" class="menu-link {% if 'relatorios' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="menu-icon fas fa-chart-bar"></i>
                    <span class="menu-text">Relatórios</span>
                </a>
            </div>
            
            <div class="menu-item">
                <a href="{% url 'info:home' %}" class="menu-link {% if 'info' in request.resolver_match.namespace %}active{% endif %}">
                    <i class="menu-icon fas fa-question-circle"></i>
                    <span class="menu-text">Ajuda</span>
                </a>
            </div>
            
            <div class="menu-item">
                <a href="{% url 'agendamentos:configuracoes' %}" class="menu-link {% if 'configuracoes' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="menu-icon fas fa-user-cog"></i>
                    <span class="menu-text">Configurações</span>
                </a>
            </div>
        </div>
    </div>
    
    <!-- Overlay para mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <!-- Topbar -->
    <div class="topbar">
        <button class="sidebar-toggle" id="sidebarToggle">
            <i class="fas fa-bars"></i>
        </button>
        
        <h1 class="d-block d-md-none page-title">Agenda Online</h1>
        <h1 class="d-none d-md-block page-title">Sistema de Agendamentos Online</h1>
        
        <div class="user-area">
            <!-- Dropdown de Temas e Modo -->
            <div class="dropdown">
                <button class="btn btn-outline-secondary btn-sm dropdown-toggle p-2" type="button" data-bs-toggle="dropdown">
                    <i class="fas fa-palette me-1"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" style="min-width: 280px;">
                    <!-- Toggle Modo Escuro -->
                    <li>
                        <h6 class="dropdown-header">
                            <i class="fas fa-adjust me-2"></i>Aparência
                        </h6>
                    </li>
                    <li class="px-3 py-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span>
                                <i class="fas fa-{% if is_dark_mode %}moon{% else %}sun{% endif %} me-2"></i>
                                Modo {% if is_dark_mode %}Escuro{% else %}Claro{% endif %}
                            </span>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" {% if is_dark_mode %}checked{% endif %} onchange="alterarModo(this.checked)">
                            </div>
                        </div>
                    </li>
                    
                    <li><hr class="dropdown-divider"></li>
                    
                    <!-- Seletor de Temas -->
                    <li>
                        <h6 class="dropdown-header">
                            <i class="fas fa-palette me-2"></i>Temas
                        </h6>
                    </li>
                    {% for tema_key, tema_info in todas_paletas.items %}
                    <li>
                        <a class="dropdown-item {% if tema_key == tema_atual %}active{% endif %}" 
                           href="#" onclick="alterarTema('{{ tema_key }}', event)">
                            <div class="d-flex align-items-center">
                                <div style="width: 20px; height: 20px; border-radius: 50%; background: {{ tema_info.gradient }}; margin-right: 10px;"></div>
                                {{ tema_info.name }}
                                {% if tema_key == tema_atual %}
                                <i class="fas fa-check ms-auto text-success"></i>
                                {% endif %}
                            </div>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            
            <!-- Usuário -->
            <div class="dropdown">
                <div class="user-info" data-bs-toggle="dropdown">
                    <div class="user-avatar">
                        {{ user.first_name|first|default:user.username|first|upper }}
                    </div>
                    <div class="user-details d-none d-md-block">
                        <h6>{{ user.get_full_name|default:user.username }}</h6>
                        <small>{{ user.email|default:"Usuário" }}</small>
                    </div>
                    <i class="d-none d-md-block fas fa-chevron-down ms-2"></i>
                </div>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li><a class="dropdown-item" href="{% url 'authentication:profile' %}">
                        <i class="fas fa-user me-2"></i>Meu Perfil
                    </a></li>
                    <li><a class="dropdown-item" href="{% url 'agendamentos:configuracoes' %}">
                        <i class="fas fa-cog me-2"></i>Configurações
                    </a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="{% url 'authentication:logout' %}">
                        <i class="fas fa-sign-out-alt me-2"></i>Sair
                    </a></li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Conteúdo Principal -->
    <div class="main-content">
        <div class="content-body">
            {% block content %}{% endblock %}
        </div>
    </div>
    
    <!-- Bootstrap JS -->   
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'js/script.js' %}"></script>
    <script src="{% static 'js/dashboard.js' %}"></script>
    <script src="{% static 'js/agendamento_detail.js' %}"></script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>